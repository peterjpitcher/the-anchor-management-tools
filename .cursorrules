# Cursor Rules / AI Assistant Instructions

You are an expert software engineer working on the Anchor Management Tools project.
Your goal is to write clean, maintainable, and standard-compliant code.

## Core Standards (Strictly Enforced)

### 1. Architecture: Service Layer Pattern
-   **THIN Server Actions**: Actions (`src/app/actions/`) must ONLY handle Permissions, Input Validation (Zod), Service Calls, and Response/Revalidation.
-   **Service Layer**: Logic lives in `src/services/`. Create a service for each domain (e.g., `TableBookingService`).
-   **Atomic Transactions**: complex writes (e.g., Create Booking + Items) MUST use a Supabase RPC function (migration) to ensure atomicity.
-   **Async Jobs**: Do NOT await slow 3rd-party APIs (Twilio/SendGrid) in actions. Queue them in the `jobs` table.

### 2. UI & Components
-   **NEVER** create new UI components if a suitable one exists in `@/components/ui` or `@/components/ui-v2`.
-   **ALWAYS** use Tailwind CSS utility classes. No custom CSS files.
-   **ALWAYS** use semantic colors (e.g., `bg-primary`) defined in `tailwind.config.js`.
-   **ALWAYS** import components from their index (e.g., `import { Button } from ...`).

### 3. Architecture & Data
-   **PREFER** Server Components for data fetching.
-   **USE** Server Actions (`src/app/actions/`) for ALL data mutations.
-   **NEVER** call Supabase client directly in a Client Component for writes; use a Server Action.
-   **ALWAYS** check permissions `checkUserPermission()` inside Server Actions before performing an action.

### 4. Database & Backend
-   **ALWAYS** use RLS policies for new tables.
-   **ALWAYS** use `UUID` for primary keys.
-   **ALWAYS** use snake_case for database columns.

### 5. Coding Style
-   **NO** `any` type. Use specific types.
-   **USE** absolute imports (`@/...`).
-   **USE** `lucide-react` for icons.

## Specific Instructions
-   When asked to "refactor" or "fix", first consult `docs/standards/ARCHITECTURE.md`.
-   When generating a new page, follow the layout pattern in `docs/standards/UI_UX.md`.
-   If you modify the DB schema, create a migration file in `supabase/migrations/` and remind the user to run migrations.

## Reference
-   Full Standards: `docs/standards/README.md`
-   Architecture Guide: `docs/standards/ARCHITECTURE.md`